version: "3.9"

services:
  telegram-bot:
    build: ./services/telegram-bot
    environment:
      PORT: 8000
      SERVICE_NAME: telegram-bot
      TRACKER_URL: http://tracker:8000
      STORAGE_DIR: /app/storage/telegram
      TELEGRAM_TOKEN: ${TELEGRAM_TOKEN:-}
      TELEGRAM_UPDATES_MODE: ${TELEGRAM_UPDATES_MODE:-polling}
    volumes:
      - ./storage:/app/storage
    ports:
      - "8001:8000"

  tracker:
    build: ./services/tracker
    environment:
      PORT: 8000
      SERVICE_NAME: tracker
      DATABASE_URL: sqlite:////tmp/tracker.db
      BOT_CALLBACK_URL: http://telegram-bot:8000/callbacks/task-result
      SYNC_TOOL_NAME: ${SYNC_TOOL_NAME:-dummy}
      SYNC_GIT_WORKDIR: /workspace/rta
      SYNC_GIT_SUBJECT_PREFIX: "chore(voice):"
    ports:
      - "8002:8000"

  tooler:
    build: ./services/tooler
    environment:
      PORT: 8000
      SERVICE_NAME: tooler
      TOOLER_ARTIFACTS_DIR: /tmp/tooler-artifacts
      GIT_PUSH: "false"
      CODEX_HOME: /codex-home
      TOOLER_CODEX_MODE: ${TOOLER_CODEX_MODE:-readonly}
      TOOLER_CODEX_MODEL: ${TOOLER_CODEX_MODEL:-}
      TOOLER_CODEX_MOCK: ${TOOLER_CODEX_MOCK:-0}
    volumes:
      - ./:/workspace/rta
      - ~/.codex:/codex-home:ro
    ports:
      - "8003:8000"

  asr:
    build: ./services/asr
    environment:
      PORT: 8000
      SERVICE_NAME: asr
    ports:
      - "8004:8000"

  refine:
    build: ./services/refine
    environment:
      PORT: 8000
      SERVICE_NAME: refine
    ports:
      - "8005:8000"

  summarizer:
    build: ./services/summarizer
    environment:
      PORT: 8000
      SERVICE_NAME: summarizer
    ports:
      - "8006:8000"

  tts:
    build: ./services/tts
    environment:
      PORT: 8000
      SERVICE_NAME: tts
    ports:
      - "8007:8000"
